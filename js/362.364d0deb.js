"use strict";(self["webpackChunkweek2"]=self["webpackChunkweek2"]||[]).push([[362],{9362:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});a(7658);var n=a(6252),i=a(3577);const s=(0,n._)("div",{class:"d-flex justify-content-center"},[(0,n._)("canvas",{id:"canvas",style:{border:"1px solid #000"}})],-1),r={class:"d-flex justify-content-between mt-3"},d=(0,n._)("div",null,[(0,n._)("p",{class:"fs-3"},"點擊加入簽名檔"),(0,n._)("img",{class:"sign",style:{border:"1px solid #000"},width:"250",height:"150"})],-1),c={class:"d-flex align-items-center"},o=["disabled"],l={class:"fs-3 mb-0"},g={class:"fs-3 mb-0"},u=["disabled"],h=(0,n._)("button",{class:"download btn btn-success fs-3"},"download PDF",-1);function w(e,t,a,w,m,f){return(0,n.wg)(),(0,n.iD)(n.HY,null,[s,(0,n._)("div",r,[d,(0,n._)("button",{class:"btn btn-danger fs-3",onClick:t[0]||(t[0]=e=>this.$router.push("/"))},"更換選擇檔案"),(0,n._)("div",c,[(0,n._)("button",{id:"forward",class:"btn btn-primary m-5",disabled:1==m.currentPage},"上一頁",8,o),(0,n._)("p",l,"當前頁數:"+(0,i.zw)(m.currentPage)+"/",1),(0,n._)("p",g,"總頁數:"+(0,i.zw)(m.maxPage),1),(0,n._)("button",{id:"next",class:"btn btn-primary m-5",disabled:m.currentPage==m.maxPage},"下一頁",8,u)]),(0,n._)("button",{class:"btn btn-danger fs-3",onClick:t[1]||(t[1]=e=>this.$router.push("/DrawView"))},"重新繪製簽名檔"),h])],64)}var m=a(2777),f={data(){return{maxPage:0,currentPage:1}},methods:{async loadFile(e){e.requestRenderAll();const t=await this.printPDF(1),a=await this.pdfToImage(t);e.setWidth(a.width/window.devicePixelRatio),e.setHeight(a.height/window.devicePixelRatio),e.setBackgroundImage(a,e.renderAll.bind(e))},readBlob(e){return new Promise(((t,a)=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.addEventListener("error",a),n.readAsDataURL(e)}))},async printPDF(e){const t=localStorage.getItem("filedata"),a=await pdfjsLib.getDocument({data:t}).promise,n=await a.getPage(e);this.maxPage=a._pdfInfo.numPages;const i=n.getViewport({scale:2}),s=document.createElement("canvas"),r=s.getContext("2d");s.height=i.height,s.width=i.width;const d={canvasContext:r,viewport:i},c=n.render(d);return c.promise.then((()=>s))},async pdfToImage(e){const t=1/window.devicePixelRatio;return new m.fabric.Image(e,{scaleX:t,scaleY:t})}},mounted(){let e=new m.fabric.Canvas("canvas");this.loadFile(e),document.querySelector("#next").addEventListener("click",(async t=>{t.preventDefault(),e.requestRenderAll(),this.currentPage!=this.maxPage&&(this.currentPage=this.currentPage+1);const a=await this.printPDF(this.currentPage),n=await this.pdfToImage(a);e.setWidth(n.width/window.devicePixelRatio),e.setHeight(n.height/window.devicePixelRatio),e.setBackgroundImage(n,e.renderAll.bind(e))})),document.querySelector("#forward").addEventListener("click",(async t=>{t.preventDefault(),e.requestRenderAll(),1!=this.currentPage&&(this.currentPage=this.currentPage-1);const a=await this.printPDF(this.currentPage),n=await this.pdfToImage(a);e.setWidth(n.width/window.devicePixelRatio),e.setHeight(n.height/window.devicePixelRatio),e.setBackgroundImage(n,e.renderAll.bind(e))}));const t=document.querySelector(".sign");localStorage.getItem("img")&&(t.src=localStorage.getItem("img"),this.testImg=localStorage.getItem("img")),t.addEventListener("click",(()=>{t.src&&m.fabric.Image.fromURL(t.src,(function(t){t.top=400,t.scaleX=.5,t.scaleY=.5,e.add(t)}))}));const a=new jsPDF,n=document.querySelector(".download");n.addEventListener("click",(()=>{const t=e.toDataURL("image/png"),n=a.internal.pageSize.width,i=a.internal.pageSize.height;a.addImage(t,"png",0,0,n,i),a.save("download.pdf")}))}},b=a(3744);const p=(0,b.Z)(f,[["render",w]]);var P=p}}]);
//# sourceMappingURL=362.364d0deb.js.map