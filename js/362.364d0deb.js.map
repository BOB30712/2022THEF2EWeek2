{"version":3,"file":"js/362.364d0deb.js","mappings":"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","sources":["webpack://week2/./src/views/PdfView2.vue","webpack://week2/./src/views/PdfView2.vue?0d44"],"sourcesContent":["<template>\r\n    <div class=\"d-flex justify-content-center\">\r\n        <canvas id=\"canvas\" style=\"border: 1px solid #000\"> </canvas>\r\n    </div>\r\n    <div class=\"d-flex justify-content-between mt-3\">\r\n        <div>\r\n            <p class=\"fs-3\">點擊加入簽名檔</p>\r\n            <img class=\"sign\" style=\"border: 1px solid #000\" width=\"250\" height=\"150\" />\r\n        </div>\r\n        <button class=\"btn btn-danger fs-3\" @click=\"this.$router.push('/')\">更換選擇檔案</button>\r\n        <div class=\"d-flex align-items-center\">\r\n            <button id=\"forward\" class=\"btn btn-primary m-5\" :disabled=\"currentPage==1\">上一頁</button>\r\n            <p class=\"fs-3 mb-0\">當前頁數:{{currentPage}}/</p>\r\n            <p class=\"fs-3 mb-0\">總頁數:{{maxPage}}</p>\r\n            <button id=\"next\" class=\"btn btn-primary m-5\" :disabled=\"currentPage==maxPage\">下一頁</button>\r\n        </div>\r\n        <button class=\"btn btn-danger fs-3\" @click=\"this.$router.push('/DrawView')\">重新繪製簽名檔</button>\r\n        <button class=\"download btn btn-success fs-3\">download PDF</button>\r\n    </div>\r\n</template>\r\n\r\n<style  lang=\"scss\">\r\n@import \"../assets/all.scss\";\r\nimg{\r\n    cursor: pointer;\r\n}\r\n</style>\r\n\r\n<script>\r\n/* eslint-disable */\r\nimport { fabric } from 'fabric'\r\nexport default {\r\n    data () {\r\n        return {\r\n            maxPage: 0,\r\n            currentPage:1\r\n        }\r\n    },\r\n    methods: {\r\n        async loadFile(canvas) {\r\n            canvas.requestRenderAll();\r\n            const pdfData = await this.printPDF(1);\r\n            //this.testData = e.target.files[0]\r\n            //this.filesize = (e.target.files[0].size/1048576).toFixed(2)\r\n            //console.log(e.target.files[0])\r\n            //this.page=1\r\n            const pdfImage = await this.pdfToImage(pdfData);\r\n            // 調整canvas大小\r\n            canvas.setWidth(pdfImage.width / window.devicePixelRatio);\r\n            canvas.setHeight(pdfImage.height / window.devicePixelRatio);\r\n            canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\r\n        },\r\n        readBlob (blob) {\r\n            return new Promise((resolve, reject) => {\r\n                const reader = new FileReader();\r\n                reader.addEventListener(\"load\", () => resolve(reader.result));\r\n                reader.addEventListener(\"error\", reject);\r\n                reader.readAsDataURL(blob);\r\n            });\r\n        },\r\n        async printPDF (page) {\r\n            const data = localStorage.getItem(\"filedata\");\r\n            // Using DocumentInitParameters object to load binary data.\r\n            const pdfDoc = await pdfjsLib.getDocument({ data }).promise;\r\n            const pdfPage = await pdfDoc.getPage(page);\r\n            this.maxPage = pdfDoc._pdfInfo.numPages \r\n            const viewport = pdfPage.getViewport({ scale: 2 });\r\n            // const viewport = pdfPage.getViewport({ scale: window.devicePixelRatio });\r\n            const canvas = document.createElement(\"canvas\");\r\n            const context = canvas.getContext(\"2d\");\r\n\r\n            // 控制顯示PDF的寬高\r\n            canvas.height = viewport.height;\r\n            canvas.width = viewport.width;\r\n            const renderContext = {\r\n                canvasContext: context,\r\n                viewport,\r\n            };\r\n            const renderTask = pdfPage.render(renderContext);\r\n\r\n            // 回傳做好的canvas\r\n            return renderTask.promise.then(() => canvas);\r\n        },\r\n        async  pdfToImage(pdfData) {\r\n        const scale = 1 / window.devicePixelRatio;\r\n        return new fabric.Image(pdfData, {\r\n            scaleX: scale,\r\n            scaleY: scale,\r\n        });\r\n        }\r\n    },\r\n    mounted () {\r\n        let canvas = new fabric.Canvas(\"canvas\");\r\n        this.loadFile(canvas);\r\n\r\n        document.querySelector(\"#next\").addEventListener(\"click\", async (e) => {\r\n            e.preventDefault();\r\n            canvas.requestRenderAll();\r\n            if(this.currentPage!=this.maxPage){\r\n                this.currentPage=this.currentPage+1;\r\n            }\r\n            const pdfData = await this.printPDF(this.currentPage);\r\n            const pdfImage = await this.pdfToImage(pdfData);\r\n            // 調整canvas大小\r\n            canvas.setWidth(pdfImage.width / window.devicePixelRatio);\r\n            canvas.setHeight(pdfImage.height / window.devicePixelRatio);\r\n            canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\r\n        });\r\n\r\n        document.querySelector(\"#forward\").addEventListener(\"click\", async (e) => {\r\n            e.preventDefault();\r\n            canvas.requestRenderAll();\r\n            if(this.currentPage!=1){\r\n                this.currentPage=this.currentPage-1;\r\n            }\r\n            const pdfData = await this.printPDF(this.currentPage);\r\n            const pdfImage = await this.pdfToImage(pdfData);\r\n            // 調整canvas大小\r\n            canvas.setWidth(pdfImage.width / window.devicePixelRatio);\r\n            canvas.setHeight(pdfImage.height / window.devicePixelRatio);\r\n            canvas.setBackgroundImage(pdfImage, canvas.renderAll.bind(canvas));\r\n        });\r\n\r\n        // 加入簽名\r\n        const sign = document.querySelector(\".sign\");\r\n        if (localStorage.getItem(\"img\")) {\r\n            sign.src = localStorage.getItem(\"img\");\r\n            this.testImg =  localStorage.getItem(\"img\");\r\n        }\r\n        sign.addEventListener(\"click\", () => {\r\n            if (!sign.src) return;\r\n            fabric.Image.fromURL(sign.src, function (image) {\r\n                image.top = 400;\r\n                image.scaleX = 0.5;\r\n                image.scaleY = 0.5;\r\n                canvas.add(image);\r\n            });\r\n        });\r\n        // 下讚PDF\r\n        const pdf = new jsPDF();\r\n        const download = document.querySelector(\".download\");\r\n        download.addEventListener(\"click\", () => {\r\n            const image = canvas.toDataURL(\"image/png\");\r\n            const width = pdf.internal.pageSize.width;\r\n            const height = pdf.internal.pageSize.height;\r\n            pdf.addImage(image, \"png\", 0, 0, width, height);\r\n            pdf.save(\"download.pdf\");\r\n        });\r\n    }\r\n}\r\n</script>\r\n","import { render } from \"./PdfView2.vue?vue&type=template&id=500e0872\"\nimport script from \"./PdfView2.vue?vue&type=script&lang=js\"\nexport * from \"./PdfView2.vue?vue&type=script&lang=js\"\n\nimport \"./PdfView2.vue?vue&type=style&index=0&id=500e0872&lang=scss\"\n\nimport exportComponent from \"C:\\\\Users\\\\USER\\\\Desktop\\\\2022TheF2E\\\\week2\\\\week2\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","id","style","width","height","_hoisted_1","_hoisted_2","_hoisted_3","onClick","$router","push","_hoisted_4","disabled","$data","_hoisted_6","_hoisted_7","_hoisted_9","data","maxPage","currentPage","methods","async","canvas","requestRenderAll","pdfData","this","printPDF","pdfImage","pdfToImage","setWidth","window","devicePixelRatio","setHeight","setBackgroundImage","renderAll","bind","readBlob","blob","Promise","resolve","reject","reader","FileReader","addEventListener","result","readAsDataURL","page","localStorage","getItem","pdfDoc","pdfjsLib","getDocument","promise","pdfPage","getPage","_pdfInfo","numPages","viewport","getViewport","scale","document","createElement","context","getContext","renderContext","canvasContext","renderTask","render","then","fabric","scaleX","scaleY","mounted","loadFile","querySelector","e","preventDefault","sign","src","testImg","image","top","add","pdf","jsPDF","download","toDataURL","internal","pageSize","addImage","save","__exports__"],"sourceRoot":""}